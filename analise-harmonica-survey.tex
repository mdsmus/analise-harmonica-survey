\documentclass{article}
\usepackage{icmc,amsmath}
\usepackage{graphicx}
\usepackage[T1]{fontenc}
\usepackage{url}

\title{A Survey of Automated Harmony Recognition and Tonality
  Detection Techniques}
 
\oneauthor
  {Pedro Kröger, Alexandre Passos, Marcos Sampaio}
  {Genos---Computer Music Research Group\\ School of Music
   \\ Federal University at Bahia, Brazil \\
  \url{pedro.kroger@gmail.com}, \url{alexandre.tp@gmail.com}, \url{mds_ufba@yahoo.com.br}}

\begin{document}

\maketitle

%% artigo deve ter 4 ou 8 paginas

\begin{abstract}
Since Winograd in 1968, the problem of using a computer to do
automated harmonic analysis has been approached, from several different
directions, most with reasonable success. On the other hand, little
has been done towards stabilishing standard benchmarks, and
identifying and solving the remaining issues of harmonic-significant
segmentation of musical pieces and properly using contextual
information.

Here we present a comprehensive survey of the existing literature on
the subject, as a means to enable more focused research on the area.
\end{abstract}

\section{Introduction}
\label{sec:introduction}
% pedro

\subsection{Introduction}
\label{sec:introduction-1}


%%% kroger:  basicamente falar que mir is a hot topic
Music information retrieval .... Some research focus on music
retrieval by query-by-humming
\cite{hu02comparison,pickens02:polyphonic,cano02:use}, in the
development of tools for digital libraries
\cite{clausen00:proms,olson03:chopin,fujinaga02:digital}, in the
detection of musical patters
\cite{lartillot-nakamura03:discovering,dannenberg02:pattern,lartillot02:integrating}
that may help, among other things, to help identifying musical styles
\cite{dixon03:classification,pampalk03:exploring,rauber02:using}, and
in problems related to musical representation
\cite{lee02:representing,good00:representing,rol00:xml4mir}.

While the main goal in music information retrieval `` is not an
understanding of music. It is not to develop a better theory of music,
or even to analyze music. The goal is retrieval''
\cite{pickens01:survey}, others researchers seek a better
understanding of elements and musical processes trough the automatic
analysis by a computer. We agree with Mouton that ``only automatic
analysis of a large corpus of tonal music may eventually provide us
(the human) with insights on the very nature of tonal music''
\cite{mouton95:numeric}. Computer-based musical analysis is important
because it can bring new insights in this area, in the same way the
use of the computer in vision and problem solving brought new insights
these areas \cite{temperley99:modeling}.

%%% kroger: scoring = arranjo?
There are many practical aplications for automatic music analysis,
among then are automated scoring, detection of posible logical
mistakes in scores, database search, automatic accompaniment
generation, and statitical analysis of musical styles for automated
composition \cite{pardo02:algorithms,temperley99:modeling}. Raphael and
%%% kroger: passive voice sucks badly
Stoddard emphasize the kinds of searches that can be made, where

\begin{quote}
  the most obvious application of harmonic analysis in music
  information retrieval (MIR) would treat queries phrased in the
  language of harmony: What are the earliest examples of the use of
  German augmented sixth chords or Neapolitan chords? Which Beatles
  songs have deceptive cadences? Where can I buy the piece I heard on
  the radio with the harmonic progression I vi IV V I repeated many
  times? It is likely that such applications will be most useful to
  musicologists since the mere formulation of such queries requires a
  more sophisticated understanding of harmony than would be expected
  of an average music enthusiast. \cite{raphael03:harmonic}
\end{quote}

By definition, automated harmony analysis must be done completely by
computer programs, without human intervention. Typically the system
accepts as input musical data in some format (such as MIDI, scores in
symbolic or numeric format, and so on) and returns as result
%%% kroger: tipo de acordes em ingles?
information such as chords roots, chords types, or symbols indicating
the tonal function. In this paper the terms ``analysis'' and
``harmonic analysis'' will be loosely used to mean automated harmonic
analysis by computer.

\subsection{The problem}
\label{sec:problem}

The problem of automated harmonic analysis might be understood by
dividing it into three non-disjoint subproblems. First, it is
necessary to have the musical piece in a form suitable for analysis,
such as MIDI, textual scores, or any other similar format. Thus,
performinc harmonic analysis of a given pieve is done by determining
the harmonic-significant segments of it, and then assigning a chord
name and a tonal function for each of those. A few sub problems might
arise, such as determining meter, or a correct pitch spelling,
depending on the suitability of the input format.

Some systems might use this information for automatically improvising
over a tune (possibly on the fly, as it is performed, which puts hard
constraints on the efficiency of the algorithms used), or harmonizing
a single melody by generating consonant voices. In this article we
focus mostly on systems that analyse simbolic data with the intention
of properly identifying each segment's harmonic function and/or

\cite{barthelemy01:figured} is probably the most complet survey to
this date.

\subsection{Historic context}
\label{sec:historic-context}

Automatically analysing music scores with a computer was first
proposed by Winograd, in 1968, using a formal-language-based approach,
with generative grammars for tonal music. This model, while
interesting for its groundbreaking consequences, was of little
practical use, generating a proper grammar for tonal music being a
non-trivial task, and parsing music with it even more so (as the
grammars produced tended to be either context-sensitive of
ambiguous). Thus, several other approaches have been tried, such as
pattern-matching over chord templates in
\cite{pardo02:algorithms,barthelemy01:figured} and neural networks, as
in \cite{tsui02:_harmon_analy_using_neural_networ}, with varying
degrees of success. No method, however, reliably detects the proper
harmonic segmentation of a given piece, nor cosiders fully musical
context, making these solutions partial by essence.


\subsection{Harmonic context}
\label{sec:harmonic-context}

\subsection{Harmonic segmentation}
\label{sec:harm-segm}

The other crucial, though underrepresented in literature, problem in
the area of automated harmonic analysis is the division of a given
piece in harmonic significant segments before associating these
segments with chords and tonal functions. This problem is non-trivial,
since the number of possible partition points in a given piece is
proportional to the number of notes - usually divided by a constant
representing the number of voices and likelihood of chords and
double-steps - and, so, the number of possible segmentations is
approximately two to the power of the number of notes in a score.

Also, the segmentation problem isn't clearly formalized in musical
theory texts, making, thus, effective algorithms for solving it
non-trivial. We believe that a more systematic approach to music
segmentation might wield considerably better results.

\section{Representation}

Before any attempt is made to extract information from a given musical
piece, it must be codified in a form amenable to automated
analysis. Representing musical information on a computer is not a
solved problem, there being a multitude of possible codifications,
from more sound-oriented ones - such as MIDI and piano roll notation -
to notations, such as \cite{kroger06:processo}, specifically made to
better transmit harmonic information. Interestingly, the choice of a
proper codification influences the results obtainable from the later
analysis. For example, a representation which fails to distinguish
enharmonic pitches might make harder to recognize a neapolitan sixth
from an augmented seventh. Thus, it is crucial that a good input
format be chosen so as to minimize errors and necessary human input in
the analysis.

\cite{harte.sandler.ea:symbolic} suggests an unambiguous notation for
chords in a format like \texttt{c:(3,5)}, \texttt{d\#:(b3,5,b7,9)/5}.
Since this notation is too verbose, the author himself proposes a
shorthand notation like \texttt{d\#:min9/5}. \cite{kroger06:processo}
proposed a notation for chords using a list in the format
\texttt{(<name> <type> <intervals> <inversion>)}, for exemplo, a G7/B
could be notated as \texttt{(g major 7 1)}. This rationale also enables
a more verbose notation like 

\begin{verbatim}
(:fundamental g
 :added-note 7
 :inversion first
 :type diminished)
\end{verbatim}


In \cite{prather96:harmonic}, pitch height is ignored, as are
accidents, and notes are represented as pitch classes only, ignoring
extra information presente in accidents. Meter, also, is widely
simplified, being reduced to a percentage of time a given pitch class
is sounding in a given measure. In \cite{buzzanca02:supervised}, meter
is represented as the logarithm of beat length, ignoring most complex
beats. \cite{barthelemy01:figured} claims to distinguish enharmonic
notes, even though the exact representation used is not discussed.
MIDI input is used in \cite{wang97:generating} and
\cite{raphael03:harmonic}. \cite{pachet96representing} describes a
codification for polyphonic tonal music, but makes no concrete claims
towards its applicability in harmonic analysis.
\cite{pardo02:algorithms}, \cite{pardo99:automated} uses a simplistic
system, representing pitches only as pitch classes, ignoring meter and
all forms of context information, with the intention of providing a
basis for sutdy of better
algorithms. \cite{tsui02:_harmon_analy_using_neural_networ} and other
systems differentiate in importance notes having different meter
strength.


Probably the simplest harmonic output is the key of a musical
passage. Most recent research on estimation of musical keys is
concerned with the analysis of audio signals
\cite{izmirli:audio,noland.sandler:key,peeters:chroma-based}. Some
research, also, focuses on translating the results to another medium.
For instance, \cite{wang97:generating} generates a 6-line guitar
score, a tablature marked with the chords for a given passage, from
the analysis of a MIDI input. The system described in
\cite{pachet00:computer} outputs not only the chord names (e.g. Db7)
but some functions used in jazz harmony like ``modal borrowing'' and
``tritone substitution''. Results from \cite{barthelemy01:figured} are
in the form of figured bass, like $7+$, $^{+6}_{\ \ \,3}$, and
$^6_5$. Most systems, as those from
\cite{pardo02:algorithms,pardo00:automated,temperley99:modeling}, use
chord notation like A$\flat$7, D$\flat$min, for A flat with minor
seventh and D flat minor, respectively.

\cite{Ulrich77IJ} performs a functional analysis of chords, indicating
information such as ``tonic of G'', ``substitute for x+2''.
%% precisa checar
But no system seems to generate a functional analysis like ii$^6_6$,
V7, and so on.
%% duvidoso. Alguns sistemas fazem isso, se não me engano.



alguns sistemas numéricos foram elaborados para manter as
características da música tonal como \cite{hewlett92:base40} e
\cite{oliveira01:codificacao}, sendo que esse último apresenta uma
solução bastante elegante baseada em um módulo 96, sendo fácil de
mapear para a representação de módulo 12. Nós acreditamos que a
pesquisa em análise harmônica poderia ser grandemente simplificada
pelo uso desses sistemas.

O problema de não levar em consideração as diferenças enarmônicas é
que acordes que possuem a mesma sonoridade mas tem função tonal
diferente não serão detectados, como o acorde de sexta alemã. Em
\cite{pardo02:algorithms}, por exemplo, um acorde de sexta alemã é
erroneamente classificado como um acorde de sétima da dominante.  

\section{Algorithms}


Many approaches related to the fields of artificial intelligence,
machine learning and pattern recognition have been applied to the
field of automated harmonic analysis. Roughly speaking, they may be
subdivided in two areas, one concerned with computerized
representation of harmonic rules and the other with inference of said
rules from probabilistic models. They are, respectively, the
deterministic and the probabilistic approach.

\subsection{Deterministic/Expert System Approaches}

Rule-based expert systems abound in the field of artificial
intelligence, so it is only natural that they should be the first
attempt at codifying musical theory in a format deemed proper for a
computer to make automated analysis.

Pattern-matching over chord templates is used in
\cite{prather96:harmonic}, \cite{pardo02:algorithms},
\cite{pardo99:automated} and \cite{barthelemy01:figured}, with the
latter using a somewhat more complex model, being capable of ignoring
ornamental notes. A rule-based expert system approach is used in
\cite{buzzanca01:rule}, but for music style
regognition. \cite{wang97:generating} uses three passes for chord
identification, all of them assuming a constant tonality, and
consisting basically of pattern-matching on many
levels. \cite{temperley99:modeling} uses a sophisticated
preference-rule based expert system to identify the roots of the
chords in a piece, but it avoids the problems of tonality detection
and harmonic function identification.

For tonality recognition, \cite{barthelemy01:figured} and
\cite{mouton95:numeric} use an ``island growing'' approach, a greedy
algorithm that is based on the fact that every chord can be only part
of a few tonalities and, detecting each of those for every chord,
tries to merge them when possible, detecting a tonality change when a
merge isn't possible. 

%%
%% Nota: o artigo de winograd foi muito citado. Ele deveria constar
%%       na nossa bibliografia? Posso comentar por terceiros a
%%       abordagem dele, se for o caso.

\subsection{Probabilistic Approaches}


Probabilistic and statistical models for automated harmonic analysis
are few, and far in between, but they have made promising
results. \cite{tsui02:_harmon_analy_using_neural_networ} and
\cite{buzzanca02:supervised} use back-propagating neural networks with
far better results. \cite{raphael03:harmonic} uses a hidden Markov
model for chordal analysis and tonal recognition.
\cite{noland.sandler:key} also uses a Hidden Markov model, but the
states represent possible keys and the inputs are the chord
changes. \cite{temperley04:bayesian} uses a bayesian model for key
recognition.

Probabilistic models, while not specifically addressing this problem,
differ from more deterministic ones in not specifically ignoring
harmonical context information, thus handling some cases slightly
better. On the other hand, due to their obliviousness to musical
theory, they are very sensitive on the training data, tending to
misbehave on slightly different scores.


\section{Segmentation}
% passos

The segmentation problem for harmonic analysis of tonal music is
largely unsolved. Due to its high computational complexity - the
number of possible partitions of a given piece being roughly
proportional to two to the power of the notes used - and its strict
dependance on context, efficient and comprehensive solutions for it
are hard to find. Still, it is of fundamental importance, for the rest
of the analysis is constrained by the existing segmentation.

\cite{prather96:harmonic} approaches the problem in a simplified
fashion, with chords being assumed to change only in the beats of a
given measure, and tonal information spread between two measures being
ignored. \cite{bod01:memory} proposes a memory-based model,
contrasting it with rule-based ones, with good results, although his
approach to segmentation in unrelated to harmonic analysis, and thus
not very relevant. \cite{barthelemy01:figured} uses melodic and
harmonic information to construct the segmentation bottom-up, i.e.
merging two adjacent segments if and only every sound of the first
belongs in the second and vice versa or if the union (with or without
ornamental notes) of both segments can be exactly mapped onto a
chord. The process starts with minimal segments and ends only when no
more merges can be performed. \cite{pardo02:algorithms} and
\cite{pardo99:automated} perform segmentation backwards, by comparing
all possible (or likely, in another version of the algorithm)
segmentations, choosing the ones that better match chord templates.

%%kroger: completar
Segmentation is also a problem in research dealing with audio formats.
\cite{abdallah.noland.ea:theory} divides the segmentation by timber,
harmony, and rhythm and pitch. ``they are not well adapted for use in
structure analysis from audio'' \cite{maddage04:content} combines
audio and symbolic representation for music structure analysis,
including chord detection.

\cite{neve.orio:experiments}

seção 3.1 de \cite{byrd02:problems}

\section{Harmonic Context}
% marcos

%% escrever: o que é contexto musical

The recent research projects that develop algorithms for automated
harmonic analysis doesn't make use of the harmonic context. However
the problems in output are, in most of cases related to context.

The set of algorithms for automated chordal analysis developed by
\cite{pardo02:algorithms} and \cite{pardo99:automated} make minimal
use of harmonic context. The errors frequencies are classified and
most of them is related to harmonic context, specifically non-chord
notes and cadence recognition.  The authors agree that a deeper
understanding about voice leading and the knowledge about neighbor
chords would help to adjust chord-label weights.

The automated harmonic analysis method developed by
\cite{barthelemy01:figured} has a simple algorithm to process
non-chord notes that produces errors. It consider that every non-chord
note is followed by a conjunct movement. The authors show problems
related to ambiguities, non-regularity of harmonic rhythm,
non-universality of harmonic rules.

%% devo incluir isso?
According to \cite{mouton95:numeric}, some works consider the harmonic
context in automated harmonic analysis (c.f. ).

The NUSO system \cite{mouton95:numeric} uses harmonic context to
define tonality through rules that consider non-chord notes in
accompanied melody, Alberti bass and baroque style. The MusES system
uses relation between adjacent chords to define the best possible
tonality for a chord.

\cite{harte.sandler.ea:symbolic} says that in classical harmony
analysis the ``chords are notated in the context of a given key'', but
in their model for chord labels, the key context is not considered.

John Rothgeb foi um dos primeiros a lidar com o problema da
harmonização automática \cite{rothgeb68:harmonizing}, nesse caso o
problema do ``baixo não cifrado'' (i.e. uma técnica onde o
intrumentista harmoniza um baixo dado mas sem as cifras do baixo
cifrado). Ele implementou em computador regras de tratados do século
XVIII e logo ficou claro que os tratados não forneciam detalhes
completos o suficiente \cite{rothgeb79:simulating}.

\section{Tests and benchmarks}

%% TODO: citar
Normaly work with an pre-maid answer key that sever as bechmarking.
That's used in .... 
%% TODO: onde, ter certeza
Sometimes the authors disagree with the results in
the answer key like in \cite{pardo02:algorithms}.

Pardo afirma em \cite{pardo02:algorithms} que nenhum pesquisador
publicou resultados estatísticos de performance em um sistema para a
análise de musica tonal antes desse artigo. A falta dessas medidas na
literatura faz com que seja difícil comparar diferentes sistemas. Ele
implementou um sistema simples que permite ser duplicado e extendido
por outros. O sistema é feito para explorar as propriedades
computacionais básicas dos algoritmos e para prover uma base na qual
outros sistemas podem ser mensurados. Dessa maneira as mudanças
introduzidas por elementos como contexto tonal, regras de condução de
vozes e informação métrica podem ser medidas
\cite{pardo02:algorithms}. Ele usa 45 trechos musicais do Kostka e
Payne \cite{kostka03:tonal} (compilados por Temperley). No apêndice
ele lista quais são os trechos. Alguns desses materiais, assim como
outros, estão disponíveis (em MIDI) em \cite{temperley01:materials}.
\cite{pickens02:polyphonic} concorda que testes padrões em coleções de
exemplos são importantes

\cite{pardo00:automated} faz uma comparação da análise da Sonata op.
13 de Beethoven, segundo movimento, compassos 1--8 com
\cite{temperley99:modeling}; \cite{barthelemy01:figured} compara seu
modelo com \cite{maxwell92:expert}, \cite{pardo99:automated} e
\cite{temperley96:algorithm}. This is (probably) the most
comprehensive comparision whe know of. O principal problema é que ele
se basea nos \textit{artigos} esses autores, e não na implementação.
Isso significa que somentes os exemplos analisados pelos autores podem
ser comparados.

Alguns sistemas tem o código-fonte disponível na internet como
\cite{sleator03:melisma}, outros tem um algoritmo detalhado em código
ou pseudo-código
\cite{mouton95:numeric,oliveira01:codificacao,pardo02:algorithms} que
permitem recontruir a pesquisa ao menos em parte. Finalmente alguns
desenvolvem modelos matemáticos \cite{raphael03:harmonic}.

\cite{pickens02:polyphonic} claims to be the first to retrieve data
from polyphonic symbolic collections using polyphonic audio queries.
It also uses a large corpus of music, 3150 pieces.
\cite{pickens02:harmonic} also uses this large corpus

\section{Conclusion and discussion}
\label{sec:concl-disc}

%%% metodos matematicos

\cite{taneyev62:counterpoint}

Ainda que existam modelos matemáticos para a análise harmônica, ainda
não é claro na literatura (tanto musical quando de MIR) se uma
abordagem utilizando a teoria dos conjuntos pode contribuir para a
solução do problema. Até onde sabemos, não existem trabalhos
significativos na literatura da análise harmônica automática em que a
teoria dos conjuntos seja abordada de maneira aprofundada.
\cite{pardo02:algorithms} usa tuplas com representação numérica das
alturas, formando templates. Ao que parece ele define todas as
transposições possíveis como templates, quando seria mais prático
calcular através da forma prima. Ele relaciona os templates com a
teoria dos conjuntos mas não a usa de forma explícita (i.e. forma
prima, vetores de índice, etc).

Uma abordagem de análise harmônica que utilize somente a teoria dos
conjuntos será de pouca utilidade, dado ao caráter reducionista dessa
teoria. Por exemplo, cada acorde na sequência Do menor, Sol maior, Do
menor tem a mesma \textbf{forma prima}, (0,3,7) e, consequentemente, o
mesmo \textbf{número de classificação de Allen Forte}, 3-11. Dessa
maneira, uma redução analítica harmônica pela teoria dos conjuntos
perderia informações importantes como a \emph{qualidade dos acordes}.
Contudo procedimentos como o vetor intervalar e operações de extração
de sub-conjuntos podem ajudar a identificar os elementos harmônicos
dos não-harmônicos. O vetor intervalar lista todos os intervalos de um
conjunto, fornecendo uma indicação confiável da sonoridade do
conjunto.

ver \cite{conklin02:representation}

\bibliographystyle{plain}
\bibliography{analise-harmonica,bib-geral,bib-outras,analise-harmonica-nao-tenho}
%\nocite{*} 
\end{document}
 
http://www.aaue.dk/~niklas/ICMC/?page_id=3

\section{Terminology}
% todos

% uma lista de possíveis termos a ser definidos, depois reduzir pra só
% os relevantes e definí-los
meter
pitch
segmentation
tonality
harmony
hidden markov model
melody
neural network
expert system
pattern matching
chord
greedy algorithm
island growing
ornamental note
music/harmonic context
Forma prima.
  Uma maneira de representar a classe de
  conjunto de uma maneira compacta e não-ambígua.
Vetor intervalar.
Uma representação compactada contendo
  todos os intervalos em um conjunto.
Número de classificação de Allen Forte.
Classificação
  usando dois dígitos proposta por Allen Forte para todas as classes
  de conjuntos. O primeiro dígito indica a quantidade de notas no
  conjunto e o segundo sua posição na lista de classes de conjuntos.
